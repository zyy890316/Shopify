{%- assign this_image_array = image | split: '.' -%}{%- assign this_img_size = img_url -%}{%- assign this_img_crop = '' -%}{%- assign this_scale = '' -%}{%- if this_img_size == 'pico'-%}{%- assign this_img_size = '16x16' -%}{%- endif -%}{%- if this_img_size == 'icon'-%}{%- assign this_img_size = '32x32' -%}{%- endif -%}{%- if this_img_size == 'thumb'-%}{%- assign this_img_size = '50x50' -%}{%- endif -%}{%- if this_img_size == 'small'-%}{%- assign this_img_size = '100x100' -%}{%- endif -%}{%- if this_img_size == 'compact'-%}{%- assign this_img_size = '160x160' -%}{%- endif -%}{%- if this_img_size == 'medium'-%}{%- assign this_img_size = '240x240' -%}{%- endif -%}{%- if this_img_size == 'large'-%}{%- assign this_img_size = '480x480' -%}{%- endif -%}{%- if this_img_size == 'grande' -%}{%- assign this_img_size = '600x600' -%}{%- endif -%}{%- if this_img_size == 'master' -%}{%- assign this_img_size = '' -%}{%- endif -%}{%- if scale != blank -%}{%- assign this_scale = scale | prepend : '@' | append : 'x' -%}{%- endif -%}{%- if crop != blank -%}{%- assign this_img_crop = crop | prepend : '_crop_' -%}{%- endif -%}{%- assign this_img_url = '' -%}{%- for this_image_part in this_image_array -%}{%- if forloop.last -%}{%- capture this_img_url-%}{{this_img_url}}{% if this_img_size != blank %}_{{this_img_size}}{% endif%}{{this_img_crop}}{{this_scale}}{% if format == 'pjpg' %}.progressive{% endif%}{%- endcapture-%}{%- endif -%}{%- if forloop.first -%}{%- assign this_img_url = this_img_url | append: this_image_part-%}{%- elsif forloop.last -%}{%- capture this_img_url-%}{{this_img_url}}.{{this_image_part}}{% if format == 'pjpg' or format == 'jpg' %}.jpg{% endif%}{%- endcapture-%}{%- else -%}{%- assign this_img_url = this_img_url | append: '.' | append: this_image_part-%}{%- endif -%}{%- endfor -%}{%- if img_tag -%}<img src="{{this_img_url}}"/>{%- else -%}{{this_img_url}}{%- endif -%}
