{% comment %}
ATB-SCHEMA{
  "name": "Map",
  "class": "index-section index-map-section",
  "id": "map",
  "banner": "",
  "icon": "",
  "tags": "",
  "description": "",
  "settings": [
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID",
      "info": "Enter a unique ID with only letters and numbers, no spaces",
      "default": ""
    },
    {
      "id": "atb_heading",
      "type": "text",
      "label": "Heading",
      "default": "Our store",
      "info": ""
    },
    {
      "id": "atb_address",
      "type": "html",
      "label": "Address and hours",
      "default": "<p>123 Fake St.<br>Toronto, Canada</p><p>Mon - Fri, 10am - 9pm<br>Saturday, 11am - 9pm<br>Sunday, 11am - 5pm</p>",
      "info": ""
    },
    {
      "id": "atb_map_address",
      "type": "text",
      "label": "Map address",
      "info": "",
      "default": "80 Spadina Ave, Toronto"
    },
    {
      "id": "atb_button_text",
      "type": "text",
      "label": "Map link label",
      "default": "Get directions",
      "info": ""
    },
    {
      "id": "atb_show_pin",
      "type": "checkbox",
      "label": "Show pin",
      "default": true,
      "info": ""
    },
    {
      "id": "atb_api_key",
      "type": "text",
      "label": "Google Maps API key",
      "info": ""
    },
    {
      "type": "image_picker",
      "id": "atb_background_image",
      "label": "Image",
      "info": ""
    },
    {
      "type": "select",
      "id": "atb_background_image_position",
      "label": "Image position",
      "default": "center center",
      "options": [
        {
          "label": "Top left",
          "value": "top left"
        },
        {
          "label": "Top center",
          "value": "top center"
        },
        {
          "label": "Top right",
          "value": "top right"
        },
        {
          "label": "Middle left",
          "value": "center left"
        },
        {
          "label": "Middle center",
          "value": "center center"
        },
        {
          "label": "Middle right",
          "value": "center right"
        },
        {
          "label": "Bottom left",
          "value": "bottom left"
        },
        {
          "label": "Bottom center",
          "value": "bottom center"
        },
        {
          "label": "Bottom right",
          "value": "bottom right"
        }
      ],
      "info": ""
    }
  ],
  "warnings": []
}ATB-SCHEMA
{% endcomment %}


{% include 'atb-render' field:'section_id' %}
{% assign section_id = val %}
{% include 'atb-render' field:'atb_heading' %}
{% assign atb_heading = val %}
{% include 'atb-render' field:'atb_address' %}
{% assign atb_address = val %}
{% include 'atb-render' field:'atb_map_address' %}
{% assign atb_map_address = val %}
{% include 'atb-render' field:'atb_button_text' %}
{% assign atb_button_text = val %}
{% include 'atb-render' field:'atb_show_pin' %}
{% assign atb_show_pin = val %}
{% include 'atb-render' field:'atb_api_key' %}
{% assign atb_api_key = val %}
{% include 'atb-render' field:'atb_background_image' %}
{% assign atb_background_image = val %}
{% include 'atb-render' field:'atb_background_image_position' %}
{% assign atb_background_image_position = val %}
{% if atb_show_pin == blank %}
{% assign atb_show_pin = false %}
{% else %}
{% assign atb_show_pin = true %}
{% endif %}
{% assign atb_background_image_key = atb_background_image| split: '/files/' | last %}{% assign atb_background_image = images[atb_background_image_key] %}
<section id="shopify-section-{{section_id}}" class="shopify-section index-section index-map-section">
{% assign display_map = false %}
{%- assign onboarding = false -%}
{%- assign bg_image = atb_background_image -%}

{%- if atb_api_key == blank and bg_image == blank -%}
  {%- assign onboarding = true -%}
{%- endif -%}
{%- if atb_api_key != blank and atb_map_address -%}
  {%- assign display_map = true -%}
{%- endif -%}

<style>
  {% if bg_image.src != blank %}
  #MapSection--{{ section_id }} .map-section__image {
    background-position: {{ atb_background_image_position }};
  }

  @media only screen and (max-width: 769px) {
    #MapSection--{{ section_id }} .map-section__image {
      padding-top: {{ 1 | divided_by: bg_image.aspect_ratio | times: 100 }}%;
    }
  }
  {% endif %}
</style>

<div id="MapSection--{{ section_id }}"
     class="map-section
          {% if display_map %}map-section--display-map{% endif %}
          {% if onboarding == true %}map-section--onboarding{% endif %}"
     data-section-id="{{ section_id }}"
     data-section-type="map">
  <div class="wrapper map-section__wrapper">
    <div class="map-section__content-wrapper flex--third">
      <div class="map-section__content">
        {% if atb_heading != blank %}
          <h3 class="h4">{{ atb_heading | escape }}</h3>
        {% endif %}
        {% if atb_address != blank %}
          <div class="rte">{{ atb_address }}</div>
          {% if atb_map_address != blank and atb_button_text != blank %}
            <p>
              <a href="https://maps.google.com?daddr={{ atb_map_address | escape }}"
                 class="btn btn--secondary map_section__directions-btn"
                 target="_blank"
              >
                {% if atb_show_pin %}
                  <span class="icon icon-pin" aria-hidden="true"></span>
                {% endif %}
                {% if atb_button_text %}
                  <span>{{ atb_button_text | escape }}</span>
                {% endif %}
              </a>
            </p>
          {% endif %}
        {% endif %}
      </div>
    </div>
    <div class="map-section__background-wrapper">
      {% if bg_image.src != blank %}
        <div class="map-section__image lazyload js"
             data-bgset="{% include 'bgset', image: bg_image %}"
             data-sizes="auto"
             data-parent-fit="cover"
             style="background-image: url('{{ bg_image | img_url: '300x300' }});">
        </div>
        <noscript>
          <div class="map-section__image" style="background-image: url({{ bg_image | img_url: 'x800', crop: 'top' }});"></div>
        </noscript>
      {% elsif onboarding == true %}
        <div class="placeholder-background">
          {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {% endif %}
      {% if display_map %}
        <div class="map-section__container"
             id="Map-{{ section_id }}"
             data-map
             data-address-setting="{{ atb_map_address | escape }}"
             data-api-key="{{ atb_api_key }}">
        </div>
        <div class="map-section__overlay" data-map-overlay></div>
      {% endif %}
    </div>
  </div>
</div>


</section>